"use strict";
var Promise = require("bluebird");
var child_process_1 = require("child_process");
function setHostname(hostname) {
    return new Promise(function (resolve, reject) {
        child_process_1.exec('avahi-set-host-name ' + hostname, function (err, stdout, stderr) {
            if (err) {
                reject(err);
            }
            else {
                resolve(true);
            }
        });
    });
}
exports.setHostname = setHostname;
function getHosts() {
    return new Promise(function (resolve, reject) {
        var results = [];
        child_process_1.exec('avahi-browse -a -r -t', function (err, stdout, stderr) {
            if (err) {
                reject(err);
            }
            else {
                var result = stdout.split('\n');
                for (var i = 0; i < result.length; i++) {
                    var row = result[i];
                    if (row.includes("=") && (row.includes("IPv4") || row.includes("IPv6"))) {
                        var words = row.split(' ');
                        var device = words[1];
                        if (row.includes("IPv4")) {
                            results.push({ interface: device, ipv4: true, ipv6: false });
                        }
                        else if (row.includes("IPv6")) {
                            results.push({ interface: device, ipv6: true, ipv4: false });
                        }
                    }
                    else if (row.includes("=")) {
                        results[results.length - 1][row.split('=')[0].replace(/ /g, '')] = row.split('[')[1].split(']')[0];
                    }
                }
                var newones = [];
                for (var i = 0; i < results.length; i++) {
                    if (results[i].ipv6) {
                        results[i].ipv6 = results[i].address;
                        results[i].port = parseInt(results[i].port);
                        for (var r = 0; r < results.length; r++) {
                            if (results[r].ipv4 && results[r].hostname === results[i].hostname) {
                                results[i].ipv4 = results[r].address;
                                results[r].delete = true;
                            }
                        }
                    }
                }
                for (var i = 0; i < results.length; i++) {
                    var newobj = Object['assign']({}, results[i]);
                    if (newobj.delete) {
                    }
                    else {
                        delete newobj.address;
                        newones.push(newobj);
                    }
                }
                resolve(newones);
            }
        });
    });
}
exports.getHosts = getHosts;
function whereHostNameIsLike(name) {
    return new Promise(function (resolve, reject) {
        getHosts().then(function (hosts) {
            var hostlikes = [];
            for (var i = 0; i < hosts.length; i++) {
                if (hosts[i].hostname['includes'](name)) {
                    hostlikes.push(hosts[i]);
                }
            }
            resolve(hostlikes);
        }).catch(function (err) {
            reject(err);
        });
    });
}
exports.whereHostNameIsLike = whereHostNameIsLike;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxJQUFZLE9BQU8sV0FBTSxVQUFVLENBQUMsQ0FBQTtBQUVwQyw4QkFBcUIsZUFJckIsQ0FBQyxDQUptQztBQWdCcEMscUJBQTRCLFFBQWdCO0lBQ3hDLE1BQU0sQ0FBQyxJQUFJLE9BQU8sQ0FBVSxVQUFDLE9BQU8sRUFBRSxNQUFNO1FBQ3hDLG9CQUFJLENBQUMsc0JBQXNCLEdBQUcsUUFBUSxFQUFFLFVBQUMsR0FBRyxFQUFFLE1BQU0sRUFBRSxNQUFNO1lBQ3hELEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQ04sTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFBO1lBQ2YsQ0FBQztZQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNKLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQTtZQUNqQixDQUFDO1FBRUwsQ0FBQyxDQUFDLENBQUE7SUFDTixDQUFDLENBQUMsQ0FBQTtBQUVOLENBQUM7QUFaZSxtQkFBVyxjQVkxQixDQUFBO0FBR0Q7SUFDSSxNQUFNLENBQUMsSUFBSSxPQUFPLENBQWUsVUFBQyxPQUFPLEVBQUUsTUFBTTtRQUM3QyxJQUFNLE9BQU8sR0FBRyxFQUFFLENBQUE7UUFDbEIsb0JBQUksQ0FBQyx1QkFBdUIsRUFBRSxVQUFDLEdBQUcsRUFBRSxNQUFNLEVBQUUsTUFBTTtZQUM5QyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUNOLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQTtZQUNmLENBQUM7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDSixJQUFNLE1BQU0sR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFBO2dCQUNqQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztvQkFDckMsSUFBTSxHQUFHLEdBQVEsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFBO29CQUMxQixFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsSUFBSSxHQUFHLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO3dCQUN0RSxJQUFNLEtBQUssR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFBO3dCQUM1QixJQUFJLE1BQU0sR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUE7d0JBQ3JCLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDOzRCQUN2QixPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFBO3dCQUNoRSxDQUFDO3dCQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQzs0QkFDOUIsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQTt3QkFDaEUsQ0FBQztvQkFDTCxDQUFDO29CQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQzt3QkFDM0IsT0FBTyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxH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QUMsQ0FBQyxLQUFLLENBQUMsVUFBQyxHQUFHO1lBQ1QsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFBO1FBQ2YsQ0FBQyxDQUFDLENBQUE7SUFFTixDQUFDLENBQUMsQ0FBQTtBQUVOLENBQUM7QUFsQmUsMkJBQW1CLHNCQWtCbEMsQ0FBQSIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFByb21pc2UgZnJvbSBcImJsdWViaXJkXCI7XG5cbmltcG9ydCB7IGV4ZWMgfSBmcm9tIFwiY2hpbGRfcHJvY2Vzc1wiXG5cblxuXG5pbnRlcmZhY2UgSUF2YWhpSG9zdCB7XG4gICAgaW50ZXJmYWNlOiBzdHJpbmc7XG4gICAgaXB2Nj86IHN0cmluZztcbiAgICBpcHY0Pzogc3RyaW5nO1xuICAgIGhvc3RuYW1lOiBzdHJpbmc7XG4gICAgcG9ydDogbnVtYmVyO1xuICAgIHR4dDogc3RyaW5nO1xuXG59XG5cblxuXG5leHBvcnQgZnVuY3Rpb24gc2V0SG9zdG5hbWUoaG9zdG5hbWU6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZTxib29sZWFuPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGV4ZWMoJ2F2YWhpLXNldC1ob3N0LW5hbWUgJyArIGhvc3RuYW1lLCAoZXJyLCBzdGRvdXQsIHN0ZGVycikgPT4ge1xuICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgIHJlamVjdChlcnIpXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc29sdmUodHJ1ZSlcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9KVxuICAgIH0pXG5cbn1cblxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0SG9zdHMoKTogUHJvbWlzZTxJQXZhaGlIb3N0W10+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2U8SUF2YWhpSG9zdFtdPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSBbXVxuICAgICAgICBleGVjKCdhdmFoaS1icm93c2UgLWEgLXIgLXQnLCAoZXJyLCBzdGRvdXQsIHN0ZGVycikgPT4ge1xuICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgIHJlamVjdChlcnIpXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHN0ZG91dC5zcGxpdCgnXFxuJylcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJlc3VsdC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCByb3c6IGFueSA9IHJlc3VsdFtpXVxuICAgICAgICAgICAgICAgICAgICBpZiAocm93LmluY2x1ZGVzKFwiPVwiKSAmJiAocm93LmluY2x1ZGVzKFwiSVB2NFwiKSB8fCByb3cuaW5jbHVkZXMoXCJJUHY2XCIpKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgd29yZHMgPSByb3cuc3BsaXQoJyAnKVxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGRldmljZSA9IHdvcmRzWzFdXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocm93LmluY2x1ZGVzKFwiSVB2NFwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdHMucHVzaCh7IGludGVyZmFjZTogZGV2aWNlLCBpcHY0OiB0cnVlLCBpcHY2OiBmYWxzZSB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyb3cuaW5jbHVkZXMoXCJJUHY2XCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5wdXNoKHsgaW50ZXJmYWNlOiBkZXZpY2UsIGlwdjY6IHRydWUsIGlwdjQ6IGZhbHNlIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocm93LmluY2x1ZGVzKFwiPVwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0c1tyZXN1bHRzLmxlbmd0aCAtIDFdW3Jvdy5zcGxpdCgnPScpWzBdLnJlcGxhY2UoLyAvZywgJycpXSA9IHJvdy5zcGxpdCgnWycpWzFdLnNwbGl0KCddJylbMF1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCBuZXdvbmVzID0gW11cbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJlc3VsdHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdHNbaV0uaXB2Nikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0c1tpXS5pcHY2ID0gcmVzdWx0c1tpXS5hZGRyZXNzXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzW2ldLnBvcnQgPSBwYXJzZUludChyZXN1bHRzW2ldLnBvcnQpXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IHIgPSAwOyByIDwgcmVzdWx0cy5sZW5ndGg7IHIrKykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdHNbcl0uaXB2NCAmJiByZXN1bHRzW3JdLmhvc3RuYW1lID09PSByZXN1bHRzW2ldLmhvc3RuYW1lKSB7XG5cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzW2ldLmlwdjQgPSByZXN1bHRzW3JdLmFkZHJlc3NcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0c1tyXS5kZWxldGUgPSB0cnVlXG5cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJlc3VsdHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IG5ld29iaiA9IE9iamVjdFsnYXNzaWduJ10oe30sIHJlc3VsdHNbaV0pXG5cblxuICAgICAgICAgICAgICAgICAgICBpZiAobmV3b2JqLmRlbGV0ZSkge1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIG5ld29iai5hZGRyZXNzXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdvbmVzLnB1c2gobmV3b2JqKVxuXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmVzb2x2ZShuZXdvbmVzKVxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0pXG4gICAgfSlcblxufVxuZXhwb3J0IGZ1bmN0aW9uIHdoZXJlSG9zdE5hbWVJc0xpa2UobmFtZTogc3RyaW5nKTogUHJvbWlzZTxJQXZhaGlIb3N0W10+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2U8SUF2YWhpSG9zdFtdPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cbiAgICAgICAgZ2V0SG9zdHMoKS50aGVuKChob3N0cykgPT4geyBcbiAgICAgICAgICAgIGNvbnN0IGhvc3RsaWtlczogSUF2YWhpSG9zdFtdID0gW11cblxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBob3N0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmIChob3N0c1tpXS5ob3N0bmFtZVsnaW5jbHVkZXMnXShuYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICBob3N0bGlrZXMucHVzaChob3N0c1tpXSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXNvbHZlKGhvc3RsaWtlcylcbiAgICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgcmVqZWN0KGVycilcbiAgICAgICAgfSlcblxuICAgIH0pXG5cbn1cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
